<%- include('partials/head', {
  title: 'User Profile',
  bodyClass: 'admin-page user-profile',
  extraHead: `
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  `
}) %>

<%
  const baseName = account && account.full_name ? account.full_name : (account && account.username ? account.username : '');
  const fullNameValue = baseName;
  const emailValue = account && account.email ? account.email : '';
  const phoneValue = profile && profile.phone ? profile.phone : (account && account.contact ? account.contact : '');
  const photoPath = profile && profile.photo ? `/images/${profile.photo}` : '';
%>

<div class="app">
  <%- include("partials/userSidebar", {
    active: "profile",
    courseCount: undefined
  }) %>

  <main class="main">
    <header class="topbar">
      <div class="crumb">USER PROFILE PAGE</div>
      <div class="topbar__pill"><i class="fa-solid fa-user"></i></div>
    </header>

    <section class="profile-hero">
      <div>
        <h1>Hello <span class="hero__name"><%= fullNameValue || 'there' %></span>,</h1>
        <p>Update your personal details and manage your account.</p>
      </div>
    </section>

    <%- include('partials/flashMessages', { messages }) %>

    <section class="profile-layout">
      <div class="profile-left">
        <div class="profile-card profile-card--photo">
          <div class="profile-card__head">
            <div class="profile-card__title">Profile Photo</div>
            <div class="profile-card__subtitle">Upload a JPG, PNG, or WEBP under 2MB.</div>
          </div>
          <div class="profile-photo">
            <% if (photoPath) { %>
              <img src="<%= photoPath %>" alt="Profile photo">
            <% } else { %>
              <div class="profile-photo__placeholder">
                <i class="fa-solid fa-user"></i>
              </div>
            <% } %>
            <form action="/profile/photo" method="post" enctype="multipart/form-data" class="profile-photo__form">
              <label class="file-label" for="photo">
                <i class="fa-solid fa-arrow-up-from-bracket"></i>
                Upload Photo
              </label>
              <input type="file" id="photo" name="photo" accept=".jpg,.jpeg,.png,.webp,.gif">
              <button class="btn btn--primary" type="submit">Save Photo</button>
            </form>
          </div>
        </div>

        <div class="profile-card">
          <div class="profile-card__head">
            <div class="profile-card__title">Profile Details</div>
            <div class="profile-card__subtitle">Keep your account info up to date.</div>
          </div>

          <form action="/profile" method="post" class="profile-form">
            <div class="profile-field">
              <label for="full_name">Full name</label>
              <input type="text" id="full_name" name="full_name" value="<%= fullNameValue %>" required>
            </div>
            <div class="profile-field">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" value="<%= emailValue %>" required>
            </div>
            <div class="profile-field">
              <label for="phone">Phone number</label>
              <input type="text" id="phone" name="phone" value="<%= phoneValue %>">
            </div>
            <div class="profile-actions">
              <button class="btn btn--primary" type="submit">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <div class="profile-right">
        <div class="profile-card">
          <div class="profile-card__head">
            <div class="profile-card__title">Reset Password</div>
            <div class="profile-card__subtitle">Use a strong password.</div>
          </div>

          <form action="/profile/password" method="post" class="profile-form">
            <div class="profile-field">
              <label for="current_password">Current password</label>
              <input type="password" id="current_password" name="current_password" required>
            </div>
            <div class="profile-field">
              <label for="new_password">New password</label>
              <input type="password" id="new_password" name="new_password" minlength="8" required>
            </div>
            <div class="profile-field">
              <label for="confirm_password">Confirm new password</label>
              <input type="password" id="confirm_password" name="confirm_password" minlength="8" required>
            </div>
            <div class="profile-field">
              <label>
                <input type="checkbox" data-show-password-target="#current_password, #new_password, #confirm_password">
                Show passwords
              </label>
            </div>
            <div class="profile-actions">
              <button class="btn btn--primary" type="submit">Reset Password</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>
</div>

<%- include('partials/showPasswordToggle') %>
<%- include('partials/footer') %>
