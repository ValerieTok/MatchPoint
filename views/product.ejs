<%- include('partials/head', { title: product.productName, bodyClass: 'bg-light' }) %>
<%- include('partials/navbar', { user, activePage: user && user.role === 'admin' ? 'inventory' : 'shopping' }) %>

  <div class="container" style="max-width: 720px;">
    <div class="card">
      <div class="row g-0">
        <div class="col-md-4 text-center p-3">
          <img class="img-fluid" src="/images/<%= product.image || 'placeholder.png' %>" alt="<%= product.productName %>">
        </div>
        <div class="col-md-8">
    <div class="card-body">
      <h3 class="card-title"><%= product.productName %></h3>
      <% const priceNum = Number(product.price || 0); %>
      <% const discountPercentage = Math.min(100, Math.max(0, Number(product.discountPercentage) || 0)); %>
      <% const hasDiscount = discountPercentage > 0; %>
      <% const discountedPrice = hasDiscount
        ? Number((priceNum * (1 - discountPercentage / 100)).toFixed(2))
        : priceNum;
      %>
      <p class="card-text mb-1">
        <% if (hasDiscount) { %>
          <span class="text-decoration-line-through text-muted me-2">$<%= priceNum.toFixed(2) %></span>
          <span class="fw-semibold text-success">$<%= discountedPrice.toFixed(2) %></span>
        <% } else { %>
          Price: $<%= priceNum.toFixed(2) %>
        <% } %>
      </p>
      <% if (hasDiscount) { %>
        <p class="card-text mb-2">
          <small class="text-danger">-<%= discountPercentage.toFixed(0) %>% off</small>
        </p>
      <% } %>
      <% if (product.offerMessage) { %>
        <div class="card-text mb-2">
          <small class="text-info"><strong>Offer:</strong> <%= product.offerMessage %></small>
        </div>
      <% } %>
      <p class="card-text mb-3">Stock: <%= product.quantity %></p>
            <% if (user && user.role === 'admin') { %>
              <p class="mt-3"><a href="/inventory">Back to inventory</a></p>
            <% } else { %>
              <form class="row g-2 align-items-end" action="/add-to-cart/<%= product.id %>" method="post">
                <div class="col-auto">
                  <label class="form-label mb-0">Qty</label>
                  <input class="form-control" type="number" name="quantity" value="1" min="1" max="<%= product.quantity %>">
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary" type="submit">Add to cart</button>
                </div>
              </form>
              <p class="mt-3"><a href="/shopping">Back to shopping</a></p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
<%- include('partials/footer') %>
