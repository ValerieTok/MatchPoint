<%- include('partials/head', { title: product.listing_title, bodyClass: 'bg-light' }) %>
<%- include('partials/navbar', { user, activePage: user && (user.role === 'admin' || user.role === 'coach') ? 'listingsManage' : 'shopping' }) %>

  <div class="container" style="max-width: 720px;">
    <div class="card">
      <div class="row g-0">
        <div class="col-md-4 text-center p-3">
          <img class="img-fluid" src="/images/<%= product.image || 'placeholder.png' %>" alt="<%= product.listing_title %>">
        </div>
        <div class="col-md-8">
    <div class="card-body">
      <h3 class="card-title"><%= product.listing_title %></h3>
      <div class="text-muted mb-2"><%= product.username %></div>
      <% if (product.description) { %>
        <p class="card-text mb-2"><%= product.description %></p>
      <% } %>
      <p class="card-text mb-2">
        <% if (product.skill_level) { %>
          <span class="badge bg-secondary text-uppercase"><%= product.skill_level %></span>
        <% } %>
        <% if (product.duration_minutes) { %>
          <span class="text-muted"> - <%= product.duration_minutes %> mins</span>
        <% } %>
      </p>
      <% if (product.session_location) { %>
        <p class="card-text mb-2">Location: <%= product.session_location %></p>
      <% } %>
      <% if (typeof product.is_active !== 'undefined' && !product.is_active) { %>
        <p class="text-muted mb-3">This listing is currently hidden.</p>
      <% } %>
            <% if (user && (user.role === 'admin' || user.role === 'coach')) { %>
              <p class="mt-3"><a href="/listingsManage">Back to listings</a></p>
            <% } else { %>
              <form class="row g-2 align-items-end" action="/listingDetail/add-to-cart/<%= product.id %>" method="post">
                <input type="hidden" name="quantity" value="1">
                <div class="col-auto">
                  <button class="btn btn-primary" type="submit" <%= product.is_active && product.available_slots > 0 ? '' : 'disabled' %>>Add to booking cart</button>
                </div>
              </form>
              <p class="mt-3"><a href="/listingsBrowse">Back to listings</a></p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
<%- include('partials/footer') %>


